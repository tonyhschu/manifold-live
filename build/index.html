<!DOCTYPE html>
<html>
  <head>
    <title>ManifoldCAD Preview</title>
    <script
      type="module"
      src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"
    ></script>
    <script>
      const timestampURL = "/lastUpdatedTime";
      let initialLoadTime;

      const eventSource = new EventSource("/reload");

      const showMessage = (message) => {
        const messages = document.getElementById("messages");
        messages.innerHTML = message;
      };

      const clearMessage = () => {
        const messages = document.getElementById("messages");
        messages.innerHTML = "";
      };

      // eventSource.onmessage = (event) => {
      //   console.log("Received event:", event);

      //   const parsedData = JSON.parse(event.data);

      //   switch (parsedData.type) {
      //     case "error":
      //       console.error("Error:", parsedData.message);
      //       showMessage(`<pre class="error">${parsedData.message}</pre>`);
      //       break;

      //     case "success":
      //       clearMessage();
      //       location.reload();

      //     default:
      //       clearMessage();
      //       console.log("Unknown event type:", event.type);
      //       break;
      //   }
      // };

      eventSource.addEventListener("error", (event) => {
        console.error("Error:", event.data);
        showMessage(`<pre class="error">${event.data}</pre>`);
      });

      eventSource.addEventListener("success", (event) => {
        clearMessage();
        location.reload();
      });
    </script>
  </head>
  <body>
    <div id="messages"></div>
    <model-viewer
      camera-controls
      min-camera-orbit="auto 0deg auto"
      max-camera-orbit="auto 180deg auto"
      shadow-intensity="1"
      interaction-prompt="none"
      alt="Editor 3D output"
      src="/file"
    >
      <div class="center" slot="poster">
        <p id="poster" style="text-align: center; line-height: 36px">
          Loading...
        </p>
      </div>
      <div id="animation">
        <button type="button" id="play" class="icon pause"></button>
        <input
          type="range"
          min="0"
          max="1"
          step="0.01"
          value="0"
          class="slider"
          id="scrubber"
        />
      </div>
    </model-viewer>
  </body>
</html>
