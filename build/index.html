<!DOCTYPE html>
<html>
  <head>
    <title>ManifoldCAD Preview</title>
    <script
      type="module"
      src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"
    ></script>
    <script>
      const timestampURL = "/lastUpdatedTime";
      let initialLoadTime;

      fetch(timestampURL)
        .then((response) => response.json())
        .then((json) => {
          initialLoadTime = json.lastUpdatedTime;

          console.log("Initial load time:", initialLoadTime);
        })
        .then(() => {
          setInterval(() => {
            // Get the last updated time from the server
            fetch(timestampURL)
              .then((response) => response.json())
              .then((json) => {
                if (json.lastUpdatedTime > initialLoadTime) {
                  // If the model has been updated, reload the page
                  location.reload();
                }
              });
          }, 1000);
        });
    </script>
  </head>
  <body>
    <model-viewer
      camera-controls
      min-camera-orbit="auto 0deg auto"
      max-camera-orbit="auto 180deg auto"
      shadow-intensity="1"
      interaction-prompt="none"
      alt="Editor 3D output"
      src="/file"
    >
      <div class="center" slot="poster">
        <p id="poster" style="text-align: center; line-height: 36px">
          Loading...
        </p>
      </div>
      <div id="animation">
        <button type="button" id="play" class="icon pause"></button>
        <input
          type="range"
          min="0"
          max="1"
          step="0.01"
          value="0"
          class="slider"
          id="scrubber"
        />
      </div>
    </model-viewer>
  </body>
</html>
